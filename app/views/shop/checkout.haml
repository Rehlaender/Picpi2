= bootstrap_form_for @order, :url => shop_checkout_path do |f|
  .row
    = f.alert_message t(:fix_errors) , error_summary: false

    .col-md-3
      .group-wrapper.side.checkout
        =image_tag  "sales_clerk/checkout-im.jpg"
        %h5=t(:basket)

    .col-md-9
      .row
        %br
        %h4= "Contenido del carrito"
        %div
          %table.table.table-hover.table-condensed
            %thead
              %tr
                %th= "Producto"
                %th
                %th= "Precio"
                %th= "Cantidad"
                %th= "Total"
            %tbody
              -current_basket.items.each do |item|
                %tr
                  %td.picture.text-center= image_tag item.product.main_picture.url(:thumb) if item.product
                  %td.name
                    = link_to shop_product_path(:link => item.product.link ) do
                      = item.name
                  %td= euros item.product.price
                  %td
                    = link_to cart_add_path( :id => item.product.id ) do
                      = image_tag "up-icon.png" , :width => 16 , :height => 16
                    = item.quantity
                    = link_to cart_remove_path( :id => item.product.id ) do
                      = image_tag "down-icon.png" , :width => 16 , :height => 16
                  %td= number_to_currency item.total

              %tr
                %th
                %th= "Precio total"
                %th
                %th
                %th= number_to_currency current_basket.total_price

  .row
    %hr

    .col-md-3
      %h4.highlight
        = "Tipo de entrega"
        .row
          .col-md-10
            %br
              - extra = 0
              - if extra = 0
                .frame.bg-high8
                  %b= "Nota" + ":"
                  = "Recuerda que después de generar tu pedido tendrás que ir a recogerlo y pagarlo a la tienda en persona."


    .col-md-9
      .row
        .col-md-7
          %h4= "Tipo de entrega de la compra: "
          %br
          - OfficeClerk::ShippingMethod.all.each_value do |s|
            .radio.hide
              = radio_button_tag "order[shipment_type]" , s.type , s.type.to_s == @order.shipment_type , "data-price" => s.price_for(current_basket).round(2)
              = s.name
              = s.price_for(current_basket).round(2)
              €
          =render "layouts/recibir"

        .col-md-4
          %h4
            = "Orden"
            = @order.number

          %table.table.table-condensed.basket-total
            %thead
              %tr
                %th= "Total por productos"
                %td.text-right
                  %span#basket_total= current_basket.total_price.round(2)
                  $
            %tbody
              %tr
                %th= "Costo de envio"
                %td.text-right
                  %span#shipping_cost= @order.shipment_price
                  $
              %tr
                %th "Total a pagar"
                %th.text-right
                  %span#order_total= @order.total_price.round(2)
                  $
        .col-md-1


  .row
    %hr
    .col-md-3
      %h4.highlight
        ="Tipo de pago"
      - if( charge = has_charge(current_clerk) )
        .row
          .col-md-6
            %b
            = t(:use_cc)
            (
            =charge.source.last4
            )
          .col-md-3.form-group
            = check_box_tag :use_card , "1" ,  params[:use_card]

    .col-md-9
      .row
        .col-md-9
          %h4= "Tipo de pago"
          = raw "Pagar personalmente en caja"


  .row
    %hr
    .col-md-3
      .row
        .col-md-9
          %h4.highlight=t(:contact_details)
          %br/

          %b=t(:previous_addresses)

          .frame#previous_address
            -if current_clerk
              - address = current_clerk.last_address
              %span.name=address[:name]
              %br/
              %span.street= address[:street]
              %br/
              %span.city= address[:city]
              %br/
              %span.phone= address[:phone]
              %br/
              %br/
              %button.btn.btn-primary.btn-xs#fill_address{:type => "button"} Käytä tätä osoitetta
            -else
              =t(:login_addresses)
    .col-md-9
      .row
        .col-md-9#address_form
          %h4= t(:contact_details)
          = f.text_field :name , :placeholder => t(:name)
          = f.text_field :street , :placeholder => t(:street)
          = f.text_field :city , :placeholder => t(:city)
          = f.text_field :phone , :placeholder => t(:phone)
          = f.email_field :email, :placeholder => t(:email)
          %hr
          .checkbox
            %label
              = radio_button_tag :validation , true , !params[:validation].blank?
              = t(:read_and_agree)
              = link_to( t(:terms) , "/page/howto",  :target => "blank")

          %button.btn.btn-primary.btn-lg#make_order{:type => "submit" , :disabled => @order.basket.items.length == 0 }
            =t(:make_order)
